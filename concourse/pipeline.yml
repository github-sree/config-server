jobs:
  - name: config-server-test
    plan:
      - get: config-server
        trigger: true
      - config:
          caches:
            - path: $HOME/.m2/repository
            - path: $HOME/.gradle/caches/
            - path: $HOME/.gradle/wrapper/
          container_limits: {}
          image_resource:
            name: ""
            source:
              repository: gradle
              tag: eclipse-temurin:17-jdk-alpine
            type: registry-image
          inputs:
            - name: config-server
          platform: linux
          run:
            args:
              - -c
              - |
                java -Xmx32m -version
                javac -J-Xmx32m -version
                
                cd config-server && chmod -R 777 .
                
                gradle wrapper
                ./gradlew rat
                ./gradlew systemTestLibs
            path: /bin/sh
            user: root
        task: run-tests
    public: true

resources:
  - icon: github
    name: config-server
    source:
      uri: https://github.com/github-sree/config-server.git
      branch: dev
    type: git